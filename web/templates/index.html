<html lang="ru"><head>
    <title>Проверить анализы</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="static/css/main.css">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" rel="stylesheet"></script>
    <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aksfileupload@1.0.0/dist/aksFileUpload.min.css">
    <!-- <script src="static/js/main.js"></script> -->
    <meta charset="UTF-8">


<body>
    <h1 class="display-5" style="text-align: center; padding-top: 3%">Проверить анализы</h1>
    <div id="uploadFile_Loader" class="upload-zone">
        <form class="form" id="uploadForm" method="post" enctype="multipart/form-data">
            <div class="upload-zone_dragover">
                <span style="font-size: 15px">Перетащите файл сюда</span>
                <span style="font-size: 10px">Можно загружать только json</span>
            </div>
            <label class="form-upload__label" for="uploadForm_file">
                <input class="form-upload__input" id="uploadForm_File" type="file" name="file_name" style="color: transparent">
            </label>


    </form>
  </div>

  <script>
    const dropFileZone = document.querySelector(".upload-zone_dragover")
const uploadInput = document.querySelector(".form-upload__input")


const uploadUrl = "/unicorns";

["dragover", "drop"].forEach(function(event) {
  document.addEventListener(event, function(evt) {
    evt.preventDefault()
    return false
  })
})

dropFileZone.addEventListener("dragenter", function() {
  dropFileZone.classList.add("_active")
})

dropFileZone.addEventListener("dragleave", function() {
  dropFileZone.classList.remove("_active")
})

dropFileZone.addEventListener("drop", function() {
  dropFileZone.classList.remove("_active")
  const file = event.dataTransfer?.files[0]
  if (!file) {
    return
  }

  if (file.type.startsWith("application/json")) {
    uploadInput.files = event.dataTransfer.files
    processingUploadFile()
  } else {
    alert("Можно загружать только json")
    return false
  }
})

uploadInput.addEventListener("change", (event) => {
  const file = uploadInput.files?.[0]
  if (file && file.type.startsWith("application/json")) {
    processingUploadFile()
  } else {
    alert("Можно загружать только json")
    return false
  }
})

function processingUploadFile(file) {
  if (file) {
    const dropZoneData = new FormData()
    const xhr = new XMLHttpRequest()

    dropZoneData.append("file", file)

    xhr.open("POST", uploadUrl, true)

    xhr.send(dropZoneData)

    xhr.onload = function () {
      if (xhr.status == 200) {
        alert("Всё загружено")
      } else {
        alert("Oшибка загрузки")
      }
      HTMLElement.style.display = "none"
    }
  }
}

function processingDownloadFileWithFetch() {
  fetch(url, {
    method: "POST",
  }).then(async (res) => {
    const reader = res?.body?.getReader();
    while (true && reader) {
      const { value, done } = await reader?.read()
      console.log("value", value)
      if (done) break
      console.log("Received", value)
    }
  })
}

  </script>


</body></html>
